version: '3'
services:
  zookeeper:
    image: confluentinc/cp-zookeeper:7.4.0
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181
      ZOOKEEPER_TICK_TIME: 2000
    ports:
      - "2181:2181"

  kafka:
    image: confluentinc/cp-kafka:7.4.0
    depends_on:
      - zookeeper
    ports:
      - "9093:9093"
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:29092,PLAINTEXT_HOST://localhost:9093
      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:29092,PLAINTEXT_HOST://0.0.0.0:9093
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT
      KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1

  kafka-ui:
    image: provectuslabs/kafka-ui:latest
    depends_on:
      - kafka
    ports:
      - "8080:8080"
    environment:
      KAFKA_CLUSTERS_0_NAME: local
      KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS: kafka:29092
      KAFKA_CLUSTERS_0_ZOOKEEPER: zookeeper:2181

  # Cluster A (Round Robin) - Workers 1-3
  worker-1:
    build: ./worker
    environment:
      - WORKER_ID=worker-1
    ports:
      - "5001:5000"
  worker-2:
    build: ./worker
    environment:
      - WORKER_ID=worker-2
    ports:
      - "5002:5000"
  worker-3:
    build: ./worker
    environment:
      - WORKER_ID=worker-3
    ports:
      - "5003:5000"

  # Cluster B (Weighted Round Robin) - Workers 4-6
  worker-4:
    build: ./worker
    environment:
      - WORKER_ID=worker-4
    ports:
      - "5004:5000"
  worker-5:
    build: ./worker
    environment:
      - WORKER_ID=worker-5
    ports:
      - "5005:5000"
  worker-6:
    build: ./worker
    environment:
      - WORKER_ID=worker-6
    ports:
      - "5006:5000"

  # Cluster C (Least Connections) - Workers 7-9
  worker-7:
    build: ./worker
    environment:
      - WORKER_ID=worker-7
    ports:
      - "5007:5000"
  worker-8:
    build: ./worker
    environment:
      - WORKER_ID=worker-8
    ports:
      - "5008:5000"
  worker-9:
    build: ./worker
    environment:
      - WORKER_ID=worker-9
    ports:
      - "5009:5000"

  # Cluster D (Least Response Time) - Workers 10-12
  worker-10:
    build: ./worker
    environment:
      - WORKER_ID=worker-10
    ports:
      - "5010:5000"
  worker-11:
    build: ./worker
    environment:
      - WORKER_ID=worker-11
    ports:
      - "5011:5000"
  worker-12:
    build: ./worker
    environment:
      - WORKER_ID=worker-12
    ports:
      - "5012:5000"
